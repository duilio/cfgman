<!-- prettier-ignore-start -->
# Utility scripts to manage the repository.

NOTE: File autogenerated by the `generate_readme` script.
See [below](#how-to-change-this-file) if you want to change it.


## Commands

This is the list of the available commands:

- `scripts/docs-build`: Build the documentation site.
- `scripts/docs-serve`: Start the local server for the doc site.
- `scripts/format-md-codeblocks`: Format python code blocks in markdown files using
  black.
- `scripts/generate_readme`: Generate the `README.md` for the `scripts/` folder.
- `scripts/lint`: Lint all files in the repo.
- `scripts/publish`: Build and publish the package.
- `scripts/test`: Run all tests.

## Reference

### docs-build

Build the documentation site.


### docs-serve

Start the local server for the doc site.


### format-md-codeblocks

Format python code blocks in markdown files using black.

Only code-blocks marked with triple backticks are detected and they need to
have the `python` language identifier.

    ```python
    x = 1  # a comment
    ```

#### Usage

Check the options with the `-h` command flag.

#### Examples

Run on a list of files:

    ./scripts/format-md-samples file ...

Run on the committed markdown files:

    ./scripts/format-md-samples $(git ls-files '*.md')

Run on all markdown files excluding hidden ones:

    ./scripts/format-md-samples .

#### Notes

Directories in the file list are expanded into all files included in the dir
ending with `.md` and not into an hidden path (path starting with `.`). If you
want to include hidden paths or files with other suffixes, just name them
explicitly.


### generate_readme

Generate the `README.md` for the `scripts/` folder.

Collect docstrings from each executable and generate a summary with a list of
each command with a short description and a reference with a longer
description.

The script format is identified by the hashbang, it currently supports only
the followings:

* python: `#!/usr/bin/env python`
* shell: `#!/bin/bash` and  `#!/bin/sh`

For shell scripts the docstring is the first block of comment excluding the
hashbang.
Python
[inspect.cleandoc](https://docs.python.org/3/library/inspect.html#inspect.cleandoc)
function is used for normalization.

#### Usage

Generate `scripts/README.md`:

    ./scripts/generate_readme

Check if there are no changes in the `README.md`:

    ./scripts/generate_readme -c

#### Template format

`README.md.template` is used as a template. The file is read and the expression
inside double-brackets (such as `{{ summary }}`) are replaced with generated
text.

A command may have an optional json dictionary for parameters.

##### Command list

- `summary` (no parameters): list of commands with their summary.
- `reference` (level: int = 0): one paragraph per command with a detailed
  description. You can change the starting heading level with the optional
  param `level`. (E.g. `{{ reference {"level": 2} }}`)

#### Docstring notes

- First paragraph is used for the summary.
- Summary must end with a punctuation character.
- Use Markdown for formatting.


### lint

Lint all files in the repo.

Just run pre-commit hooks and mypy on all files.


### publish

Build and publish the package.

This script is tailored to the following workflow:

- `main` branch is the development branch.
- once a tag is pushed, that tag is deployed.

#### Rules

- format supported: `N.N.N*[{a|b|rc}N]`.
- tag and package version mismatch: error.
- version already exist: error.
- pre-release, is last version, unstable major: deploy.
- pre-release, other cases: deploy without docs.
- is last version: deploy and update latest alias.
- otherwise: deploy.

#### Notes

A `major` is considered unstable if it doesn't have releases (pre-releases do
not count).


### test

Run all tests.

## How to change this file

To change the content of this file you can:

- change the docstring of the executable scripts in this folder.
- change the template in the `README.md.template` file.
- change the generation script `generate_readme`.
<!-- prettier-ignore-end -->
